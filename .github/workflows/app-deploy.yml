name: Application deploy

on:
  push:
    branches:
      - main
    paths:
      - "app/**"  # Only trigger if files in the infra directory are changed
      - ".github/workflows/app-deploy.yml"  # Trigger on changes to this workflow file


jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2


    - name: Deploy Application to GKE
      run: |
        kubectl apply -f app/deployment.yaml
        kubectl apply -f app/service.yaml
      env:
        MONGODB_URI: ${{ env.MONGODB_URI }}